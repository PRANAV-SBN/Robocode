<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV and XML Export</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            display: flex;
        }
        .form-section, .table-section {
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-section">
            <label for="teacher-select">Select Teacher:</label>
            <select id="teacher-select" onchange="loadTeacherDetails()">
                <!-- Options will be populated dynamically -->
            </select>

            <div>
                <label for="teacher-name">Name:</label>
                <input type="text" id="teacher-name" name="teacher-name">
            </div>
            <div>
                <label for="date">Date:</label>
                <input type="date" id="date" name="date">
            </div>
            <div>
                <label for="time">Time:</label>
                <input type="time" id="time" name="time">
            </div>
            <div>
                <label for="utbildning">Utbildning:</label>
                <input type="text" id="utbildning" name="utbildning">
            </div>

            <h3>Students</h3>
            <div id="student-table-container"></div>

            <button onclick="submitForm()">Submit</button>
        </div>
    </div>

    <script>
        let teacherData = {};

        async function loadTeacherNames() {
            try {
                const response = await fetch('teachers.txt');
                const data = await response.text();
                const teachers = data.split('\n').filter(name => name.trim() !== '');

                populateTeacherSelect(teachers);
            } catch (error) {
                console.error('Error fetching teacher names:', error);
            }
        }

        function populateTeacherSelect(teachers) {
            const teacherSelect = document.getElementById('teacher-select');
            teacherSelect.innerHTML = '';

            teachers.forEach((teacher, index) => {
                const option = document.createElement('option');
                option.value = teacher;
                option.textContent = teacher;
                teacherSelect.appendChild(option);
            });

            if (teachers.length > 0) {
                loadTeacherDetails();
            }
        }

        function loadTeacherDetails() {
            const teacherSelect = document.getElementById('teacher-select').value;
            const teacherNameInput = document.getElementById('teacher-name');
            teacherNameInput.value = teacherSelect;

            if (!teacherData[teacherSelect]) {
                teacherData[teacherSelect] = {
                    name: teacherSelect,
                    students: []
                };
            }

            displayStudentTable(teacherSelect);
        }

        function submitForm() {
            const teacherSelect = document.getElementById("teacher-select").value;
            const teacherNameInput = document.getElementById('teacher-name').value;
            const date = document.getElementById("date").value;
            const time = document.getElementById("time").value;
            const utbildning = document.getElementById("utbildning").value;

            teacherData[teacherSelect].name = teacherNameInput;

            const csvContent = generateCSV(teacherData[teacherSelect], date, time, utbildning);
            const xmlContent = generateXML(teacherData[teacherSelect], date);

            downloadFile(csvContent, "students.csv", "text/csv");
            downloadFile(xmlContent, "students.xml", "application/xml");
        }

        function generateCSV(teacherDetails, date, time, utbildning) {
            let csv = `LÃ¤rare,${teacherDetails.name}\nDatum,${date} kl:${time}\nUtbildning,${utbildning}\n\n`;
            csv += `Nr,Namn,Per.No,Mob.Nr,Email,ID\n`;

            teacherDetails.students.forEach(student => {
                csv += `${student.no},${student.name},${student.perNo},${student.mobNr},${student.email},${student.id}\n`;
            });

            return csv;
        }

        function generateXML(teacherDetails, date) {
            let xml = `<Rapport>\n`;

            teacherDetails.students.forEach(student => {
                xml += `  <Elev>\n`;
                xml += `    <PersonNr>${student.perNo}</PersonNr>\n`;
                xml += `    <UtbDatum>${date}</UtbDatum>\n`;
                xml += `  </Elev>\n`;
            });

            xml += `</Rapport>`;

            return xml;
        }

        function downloadFile(content, fileName, mimeType) {
            const a = document.createElement("a");
            const blob = new Blob([content], { type: mimeType });
            a.href = URL.createObjectURL(blob);
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

      

        // Load teacher names when the page loads
        window.onload = loadTeacherNames;
    </script>
</body>
</html>
